<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumina | Navigacija Duše</title>
    <style>
        :root {
            --primary: #4ecca3;
            --bg-deep: #1a1a2e;
            --bg-card: #16213e;
            --accent: #0f3460;
            --text: #e9ecef;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-deep);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        .app-container {
            width: 100%;
            max-width: 700px;
            background: var(--bg-card);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }

        canvas {
            width: 100%;
            height: 220px;
            background: #0a192f;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .input-section h2 { font-weight: 300; margin-top: 0; color: var(--primary); }

        textarea {
            width: 100%;
            height: 100px;
            background: var(--accent);
            border: 1px solid #30475e;
            border-radius: 10px;
            color: white;
            padding: 15px;
            font-size: 1rem;
            box-sizing: border-box;
            outline: none;
            transition: border 0.3s;
        }

        textarea:focus { border-color: var(--primary); }

        .btn-save {
            background: var(--primary);
            color: var(--bg-deep);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
            transition: transform 0.1s;
        }

        .btn-save:active { transform: scale(0.98); }

        .log-archive {
            margin-top: 30px;
            border-top: 1px solid #30475e;
            padding-top: 20px;
        }

        .log-item {
            background: rgba(255,255,255,0.03);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 0.9rem;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .status-bar { display: flex; justify-content: space-between; font-size: 0.8rem; margin: 10px 0; color: #888; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="input-section">
        <h2>Lumina Dashboard</h2>
        <canvas id="luminaCanvas"></canvas>
        
        <div class="status-bar">
            <span>Usklađenost: <b id="scoreLabel">50%</b></span>
            <span>Trend: <b id="trendLabel">Stabilno</b></span>
        </div>

        <textarea id="entryInput" placeholder="Što vam sudbina poručuje? Unesite znak ili misao..."></textarea>
        <button class="btn-save" onclick="saveLog()">Zapiši u Brodski Dnevnik</button>
        
        <p id="feedback" style="font-size: 0.85rem; color: #aaa; margin-top: 15px; font-style: italic;"></p>
    </div>

    <div class="log-archive">
        <h3 style="font-weight: 300;">Povijest Znakova (Ship's Log)</h3>
        <div id="logArchive"></div>
    </div>
</div>

<script>
    const canvas = document.getElementById('luminaCanvas');
    const ctx = canvas.getContext('2d');
    const entryInput = document.getElementById('entryInput');
    const feedback = document.getElementById('feedback');
    const logArchive = document.getElementById('logArchive');

    // State Variables
    let currentAlignment = 50;
    let cloudDensity = 0;
    let waveOffset = 0;
    let history = [50, 50, 50];

    const divineWords = ['hvala', 'prihvaćam', 'duša', 'ljubav', 'mir', 'oprost', 'vjera', 'znak', 'dar', 'bog', 'čišćenje'];
    const humanWords = ['kriv', 'strah', 'problem', 'nepravda', 'zašto', 'stres', 'mržnja', 'osveta', 'plan', 'žalost'];

    entryInput.addEventListener('input', (e) => {
        const text = e.target.value.toLowerCase();
        let d = 0, h = 0;
        divineWords.forEach(w => { if(text.includes(w)) d += 2; });
        humanWords.forEach(w => { if(text.includes(w)) h += 2; });

        currentAlignment = (d + h === 0) ? 50 : (d / (d + h)) * 100;
        
        document.getElementById('scoreLabel').innerText = Math.round(currentAlignment) + "%";
        updateTrend();
    });

    function updateTrend() {
        history.push(currentAlignment);
        if(history.length > 15) history.shift();
        const avg = history.reduce((a, b) => a + b) / history.length;
        cloudDensity = Math.max(0, (55 - avg) * 2.5);
        
        const trend = document.getElementById('trendLabel');
        if(avg < 40) {
            trend.innerText = "Olujno"; trend.style.color = "#ff4d4d";
            feedback.innerText = "Nakupljanje teške energije. Vratite se u stanje ljubavi.";
        } else {
            trend.innerText = "Vedro"; trend.style.color = "#4ecca3";
            feedback.innerText = "Vaš brod plovi u skladu s Božanskom voljom.";
        }
    }

    function saveLog() {
        if(entryInput.value.length < 3) return;
        const item = document.createElement('div');
        item.className = 'log-item';
        const color = currentAlignment > 50 ? '#4ecca3' : '#ff4d4d';
        item.style.borderLeft = `3px solid ${color}`;
        item.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${entryInput.value} <span style="float:right; opacity:0.5">${Math.round(currentAlignment)}%</span>`;
        logArchive.prepend(item);
        entryInput.value = "";
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 1. Draw Clouds
        if(cloudDensity > 5) {
            ctx.fillStyle = `rgba(100, 110, 140, ${cloudDensity/100})`;
            for(let i=0; i<4; i++) {
                ctx.beginPath();
                ctx.arc(80 + i*130, 40, 30 + cloudDensity/3, 0, Math.PI*2);
                ctx.fill();
            }
        }

        // 2. Draw Waves
        waveOffset += (105 - currentAlignment) / 25;
        ctx.fillStyle = currentAlignment < 45 ? "#0a192f" : "#1b4965";
        ctx.beginPath();
        ctx.moveTo(0, canvas.height);
        for(let x=0; x<=canvas.width; x++) {
            ctx.lineTo(x, 150 + Math.sin((x + waveOffset) * 0.02) * (15 + (100-currentAlignment)/6));
        }
        ctx.lineTo(canvas.width, canvas.height); ctx.fill();

        // 3. Draw Boat
        const boatY = 145 - (currentAlignment * 0.3) + Math.sin(waveOffset * 0.05) * 4;
        ctx.save();
        ctx.translate(canvas.width/2, boatY);
        ctx.fillStyle = "#5d4037"; // Hull
        ctx.beginPath(); ctx.moveTo(-35, 0); ctx.lineTo(35, 0); ctx.lineTo(25, 18); ctx.lineTo(-25, 18); ctx.fill();
        ctx.fillStyle = "white"; // Sail
        ctx.beginPath(); ctx.moveTo(0, -5); ctx.lineTo(0, -45); ctx.lineTo(30, -5); ctx.fill();
        ctx.restore();

        requestAnimationFrame(draw);
    }

    canvas.width = 600; canvas.height = 220;
    draw();
</script>

</body>
</html>